package eComProject;

import java.time.Duration;
import java.util.concurrent.TimeUnit;

import org.openqa.selenium.By;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;
import org.testng.annotations.Test;
import Mobile.Base;
import io.appium.java_client.AppiumBy;

public class Test1 extends Base {

	@Test
	public void fillform() throws InterruptedException {
		driver.manage().timeouts().implicitlyWait(2000,TimeUnit.SECONDS);
		driver.findElement(AppiumBy.className("android.widget.EditText")).sendKeys("Harshal");
		driver.hideKeyboard();
		driver.findElement(By.id("com.androidsample.generalstore:id/radioFemale")).click();
		driver.findElement(AppiumBy.id("com.androidsample.generalstore:id/spinnerCountry")).click();
		driver.findElement(AppiumBy.androidUIAutomator("new UiScrollable(new UiSelector()).scrollIntoView(text(\"Argentina\"));"));
		driver.findElement(AppiumBy.xpath("//android.widget.TextView[@resource-id=\"android:id/text1\" and @text=\"Argentina\"]")).click();
		driver.findElement(AppiumBy.className("android.widget.Button")).click();
		Thread.sleep(2000);
	}
	
	@Test
	public void errorToast() {
		driver.manage().timeouts().implicitlyWait(2000,TimeUnit.SECONDS);
		driver.hideKeyboard();
		driver.findElement(By.id("com.androidsample.generalstore:id/radioFemale")).click();
		driver.findElement(AppiumBy.id("com.androidsample.generalstore:id/spinnerCountry")).click();
		driver.findElement(AppiumBy.androidUIAutomator("new UiScrollable(new UiSelector()).scrollIntoView(text(\"Argentina\"));"));
		driver.findElement(AppiumBy.xpath("//android.widget.TextView[@resource-id=\"android:id/text1\" and @text=\"Argentina\"]")).click();
		driver.findElement(AppiumBy.className("android.widget.Button")).click();
		try {
			Thread.sleep(3000);
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		String toast = driver.findElement(By.xpath("(//android.widget.Toast)[1]")).getAttribute("name");
		Assert.assertEquals(toast, "Please enter your name");
	}
	
	@Test
	public void addtoCart() throws InterruptedException {
		fillform();
		driver.findElement(AppiumBy.androidUIAutomator("new UiScrollable(new UiSelector()).scrollIntoView(text(\"Jordan 6 Rings\"));"));
		
		int count = driver.findElements(By.id("com.androidsample.generalstore:id/productName")).size();
		
		for(int i=0;i<count;i++) {
			String pname = driver.findElements(By.id("com.androidsample.generalstore:id/productName")).get(i).getText();
			
			if(pname.equalsIgnoreCase("Jordan 6 Rings")) {
				driver.findElements(By.id("com.androidsample.generalstore:id/productAddCart")).get(i).click();
			}
		}
		driver.findElement(By.id("com.androidsample.generalstore:id/appbar_btn_cart")).click();
		Thread.sleep(2000);
		
		WebElement ptitle = driver.findElement(By.id("com.androidsample.generalstore:id/toolbar_title"));
		WebDriverWait wait = new WebDriverWait(driver,Duration.ofSeconds(5));
		wait.until(ExpectedConditions.visibilityOf(ptitle));
		wait.until(ExpectedConditions.attributeContains(ptitle,"text", "Cart"));
		String addcartText = driver.findElement(By.id("com.androidsample.generalstore:id/productName")).getText();
		Assert.assertEquals(addcartText, "Jordan 6 Rings");	
	}
	
	@Test
	public void productAmount() throws InterruptedException {
		fillform();
		int pcount = driver.findElements(AppiumBy.id("com.androidsample.generalstore:id/productName")).size();
		for(int i=0;i<pcount;i++) {
			driver.findElements(AppiumBy.id("com.androidsample.generalstore:id/productAddCart")).get(i).click();
		}
		driver.findElement(By.id("com.androidsample.generalstore:id/appbar_btn_cart")).click();
		Thread.sleep(3000);
		
		double totalamount = Double.parseDouble(driver.findElement(AppiumBy.id("com.androidsample.generalstore:id/totalAmountLbl")).getText().substring(1));
		
		int acount = driver.findElements(AppiumBy.id("com.androidsample.generalstore:id/productPrice")).size();
		int totalprice = 0;
		for(int i =0;i<acount;i++) {
			
			String pamount = driver.findElements(AppiumBy.id("com.androidsample.generalstore:id/productPrice")).get(i).getText();
			double price = Double.parseDouble(pamount.substring(1));
			totalprice+=price;
			System.out.println(totalprice);
		}
		Assert.assertEquals(totalprice, totalamount);
	}
}
